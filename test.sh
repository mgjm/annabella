#!/bin/sh -eu

set -o pipefail

name="$1"
out="${name%.*}"

cargo build

echo
echo --------------------------------------------------------------------------------
echo

target/debug/annabella-rs "$name" \
| clang-format \
> "$out.c"

echo
echo --------------------------------------------------------------------------------
echo

cat "$out.c"


echo
echo --------------------------------------------------------------------------------
echo

gcc -o "$out" "$out.c"

echo
echo --------------------------------------------------------------------------------
echo
./"$out"
